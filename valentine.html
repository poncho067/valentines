<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>ğŸ’• My Valentine</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;1,400;1,600&family=Dancing+Script:wght@600;700&family=Cormorant+Garamond:ital,wght@1,300;1,400&display=swap" rel="stylesheet"/>
<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RESET & BASE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

:root {
  --rose:       #e8446a;
  --rose-mid:   #c9305a;
  --rose-light: #f7b8c8;
  --petal:      #fde8ef;
  --deep:       #1e0810;
  --gold:       #d4a85a;
  --purple:     #9b5de5;
  --pink2:      #f15bb5;
  /* iPhone safe area */
  --safe-top:    env(safe-area-inset-top,    0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;          /* â† FIXED: no scroll movement */
  background: #0d0508;
  font-family: 'Cormorant Garamond', serif;
  touch-action: pan-y;       /* allow touch tracking */
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   FULL-SCREEN FIXED STAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#stage {
  position: fixed;
  inset: 0;
  /* extra bottom padding for iPhone home bar */
  padding-bottom: var(--safe-bottom);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   FLOATING PETALS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#petals {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 10;
  overflow: hidden;
}
.petal {
  position: absolute;
  top: -20px;
  border-radius: 50% 0 50% 0;
  animation: petalFall linear infinite;
  opacity: 0;
}
@keyframes petalFall {
  0%   { transform: translateY(-20px) rotate(0deg)   translateX(0);    opacity: .7; }
  40%  { opacity: .55; }
  100% { transform: translateY(105vh) rotate(420deg) translateX(18px); opacity: 0; }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LAYER SYSTEM
   Both layers sit exactly on top of each other.
   JS drives opacity to crossfade.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.layer {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: opacity .05s linear;  /* tiny â€” JS does most smoothing */
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYER A â€” PHOTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#layer-photo {
  z-index: 1;
  opacity: 1;
}

/* â”€â”€ Photo fills entire screen â”€â”€ */
#photo-bg {
  position: absolute;
  inset: 0;
  background: linear-gradient(145deg, #3a0a1e 0%, #1a0510 55%, #2d0a1a 100%);
  background-image: url('couple.jpeg');
  background-size: cover;
  background-position: center center;
}
/* Bottom gradient so text is readable */
#photo-vignette {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(ellipse at center, transparent 25%, rgba(0,0,0,.5) 100%),
    linear-gradient(to bottom,
      rgba(0,0,0,.1)  0%,
      transparent     25%,
      transparent     55%,
      rgba(0,0,0,.75) 100%);
  z-index: 2;
}

/* Caption & scroll hint anchored to bottom */
.photo-footer {
  position: absolute;
  bottom: calc(5vh + var(--safe-bottom));
  left: 0; right: 0;
  z-index: 3;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.2rem;
  padding: 0 1.5rem;
}

.photo-caption {
  font-family: 'Dancing Script', cursive;
  color: #fff;
  font-size: clamp(1.6rem, 6vw, 2.2rem);
  text-align: center;
  line-height: 1.3;
  text-shadow: 0 2px 24px rgba(232,68,106,.55);
  opacity: 0;
  animation: riseIn 1.1s 1.1s cubic-bezier(.22,1,.36,1) forwards;
}
.photo-tagline {
  font-style: italic;
  color: var(--rose-light);
  font-size: clamp(.8rem, 3vw, 1rem);
  letter-spacing: .18em;
  opacity: 0;
  animation: riseIn 1s 1.6s cubic-bezier(.22,1,.36,1) forwards;
}

.scroll-hint {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: .35rem;
  opacity: 0;
  animation: riseIn 1s 2.1s forwards;
}
.scroll-label {
  color: rgba(255,255,255,.4);
  font-style: italic;
  font-size: .78rem;
  letter-spacing: .14em;
}
.chevs { display: flex; flex-direction: column; align-items: center; gap: 2px; }
.chev {
  width: 16px; height: 16px;
  border-right: 1.5px solid rgba(255,255,255,.45);
  border-bottom: 1.5px solid rgba(255,255,255,.45);
  transform: rotate(45deg);
  animation: chevBounce 1.7s ease-in-out infinite;
}
.chev:nth-child(2) { animation-delay: .14s; opacity: .5; }
.chev:nth-child(3) { animation-delay: .28s; opacity: .2; }

@keyframes riseIn {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0);    }
}
@keyframes chevBounce {
  0%,100% { transform: rotate(45deg) translate(0,0); }
  50%     { transform: rotate(45deg) translate(4px,4px); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYER B â€” ENVELOPE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#layer-envelope {
  z-index: 2;
  opacity: 0;
  background: radial-gradient(ellipse at 50% 50%, #1e060f 0%, #0d0508 100%);
  pointer-events: none;   /* disabled until visible */
}
#layer-envelope.active { pointer-events: auto; }

/* Glow blob */
#layer-envelope::before {
  content: '';
  position: absolute;
  width: min(500px, 90vw);
  height: min(500px, 90vw);
  background: radial-gradient(circle, rgba(232,68,106,.13) 0%, transparent 70%);
  border-radius: 50%;
  top: 50%; left: 50%;
  transform: translate(-50%,-50%);
}

/* â”€â”€ Envelope container â”€â”€ */
#env-scene {
  position: relative;
  width: min(320px, 82vw);
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Grows from tiny as layer fades in â€” JS also drives scale on scroll progress */
#env-scene {
  transform: scale(0.1);
  transition: none;
}

/* tap hint */
#env-tap {
  margin-top: 1.4rem;
  font-style: italic;
  color: rgba(255,255,255,.4);
  font-size: .82rem;
  letter-spacing: .12em;
  opacity: 0;
  transition: opacity .5s;
  animation: gentlePulse 2.4s ease-in-out infinite;
}
#layer-envelope.active #env-tap { opacity: 1; }
@keyframes gentlePulse { 0%,100%{opacity:.4} 50%{opacity:.85} }

/* â•â•â•â• ENVELOPE VISUAL â•â•â•â• */
.envelope {
  position: relative;
  width: 100%;
  cursor: pointer;
  user-select: none;
}

.env-body {
  position: relative;
  width: 100%;
  padding-top: 64%;
  border-radius: 5px 5px 14px 14px;
  box-shadow:
    0 0 0 1px rgba(255,255,255,.07),
    0 28px 80px rgba(0,0,0,.7),
    0 4px 20px rgba(232,68,106,.1),
    inset 0 1px 0 rgba(255,255,255,.07);
  overflow: visible;
}

.env-back {
  position: absolute; inset: 0;
  background: linear-gradient(160deg, #2e0b1a, #1e0710);
  border-radius: 5px 5px 14px 14px;
  z-index: 0;
}

.env-tri {
  position: absolute;
  bottom: 0;
  height: 58%; width: 50%;
  z-index: 2;
}
.env-tri-l {
  left: 0;
  background: linear-gradient(135deg, #5c1b30, #3e0e1f);
  clip-path: polygon(0 0, 0 100%, 100% 100%);
}
.env-tri-r {
  right: 0;
  background: linear-gradient(225deg, #5c1b30, #3e0e1f);
  clip-path: polygon(100% 0, 0 100%, 100% 100%);
}

.env-bottom {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 56%;
  z-index: 1;
  background: linear-gradient(160deg, #4c1226, #301020);
  clip-path: polygon(0 100%, 50% 0, 100% 100%);
}

.env-flap {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 60%;
  background: linear-gradient(170deg, #6c2032 0%, #4a1222 60%, #3a0e1c 100%);
  clip-path: polygon(0 0, 50% 100%, 100% 0);
  transform-origin: 50% 0%;
  transition: transform .8s cubic-bezier(.34,1.1,.64,1);
  z-index: 5;
  border-radius: 5px 5px 0 0;
}
.env-flap::after {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(170deg, rgba(212,168,90,.22) 0%, transparent 50%);
  clip-path: polygon(0 0, 50% 100%, 100% 0);
}
.envelope.open .env-flap { transform: rotateX(-180deg); }

/* Wax seal */
.env-seal {
  position: absolute;
  top: 47%; left: 50%;
  transform: translate(-50%,-50%);
  z-index: 6;
  transition: transform .35s, opacity .35s;
}
.envelope.open .env-seal { transform: translate(-50%,-50%) scale(0); opacity: 0; }
.seal-svg {
  width: 48px; height: 48px;
  filter: drop-shadow(0 0 10px rgba(232,68,106,.7));
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CARD â€” overlays ON TOP of envelope
   (centered over the envelope body)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.env-card {
  position: absolute;
  /* sits centered over the envelope */
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.6);
  width: 90%;
  background: linear-gradient(155deg, #fff8fb, #fff0f5);
  border-radius: 14px;
  padding: 1.8rem 1.4rem 1.6rem;
  box-shadow:
    0 0 0 1px rgba(232,68,106,.15),
    0 20px 60px rgba(0,0,0,.55),
    inset 0 1px 0 #fff;
  z-index: 8;
  text-align: center;
  opacity: 0;
  pointer-events: none;
  transition:
    transform .85s cubic-bezier(.34,1.3,.64,1) .1s,
    opacity   .6s  ease              .1s;
}
.envelope.open .env-card {
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
  pointer-events: auto;
}

/* Card content */
.card-icon { font-size: 2rem; display: block; margin-bottom: .4rem; animation: hb 1.3s ease-in-out infinite; }
@keyframes hb {
  0%,100%{transform:scale(1)}
  15%    {transform:scale(1.22)}
  30%    {transform:scale(1)}
  45%    {transform:scale(1.1)}
}

.env-card h2 {
  font-family: 'Playfair Display', serif;
  font-style: italic;
  color: #2a0f18;
  font-size: clamp(1.2rem, 5vw, 1.5rem);
  line-height: 1.3;
  margin-bottom: .35rem;
}
.env-card p {
  color: #8a3a50;
  font-style: italic;
  font-size: clamp(.82rem, 3.2vw, .92rem);
  line-height: 1.65;
  margin-bottom: 1.3rem;
}

.choices {
  display: flex;
  gap: .75rem;
  justify-content: center;
  flex-wrap: wrap;
}
.btn {
  border: none;
  border-radius: 50px;
  padding: .6rem 1.4rem;
  font-family: 'Dancing Script', cursive;
  font-size: clamp(1.1rem, 4.5vw, 1.2rem);
  cursor: pointer;
  transition: transform .18s, box-shadow .18s;
  line-height: 1;
  outline: none;
}
.btn:active { transform: scale(.93); }
.btn-yes  {
  background: linear-gradient(135deg, #e8446a, #c0284c);
  color: #fff;
  box-shadow: 0 4px 16px rgba(232,68,106,.45);
}
.btn-yes:hover  { transform: scale(1.07); box-shadow: 0 6px 22px rgba(232,68,106,.6); }
.btn-yes2 {
  background: linear-gradient(135deg, #9b5de5, #f15bb5);
  color: #fff;
  box-shadow: 0 4px 16px rgba(155,93,229,.45);
}
.btn-yes2:hover { transform: scale(1.07); box-shadow: 0 6px 22px rgba(155,93,229,.6); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LOVE OVERLAY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#love-overlay {
  position: fixed;
  inset: 0;
  background: radial-gradient(ellipse at 50% 45%, #2e0a16 0%, #0d0508 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9000;
  opacity: 0;
  pointer-events: none;
  transition: opacity .9s;
}
#love-overlay.show { opacity: 1; pointer-events: auto; }

.love-box {
  text-align: center;
  padding: 2rem 1.5rem;
  animation: loveIn .85s .1s cubic-bezier(.34,1.45,.64,1) both;
}
@keyframes loveIn {
  from { transform: scale(.5); opacity: 0; }
  to   { transform: scale(1);  opacity: 1; }
}
.love-heart-big {
  font-size: clamp(3.5rem, 16vw, 6.5rem);
  display: block;
  margin-bottom: .5rem;
  animation: hb 1s ease-in-out infinite;
}
.love-box h1 {
  font-family: 'Dancing Script', cursive;
  font-size: clamp(3rem, 12vw, 5rem);
  color: var(--rose-light);
  text-shadow: 0 0 40px rgba(232,68,106,.8), 0 0 80px rgba(232,68,106,.35);
  line-height: 1.1;
  margin-bottom: .5rem;
}
.love-sub {
  font-family: 'Playfair Display', serif;
  font-style: italic;
  color: rgba(255,255,255,.55);
  font-size: clamp(.95rem, 4vw, 1.2rem);
}
.love-row { margin-top: 1rem; font-size: 1.4rem; letter-spacing: .4em; animation: gentlePulse 1.8s ease-in-out infinite; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   EXPLOSION & BLACKOUT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#blackout-overlay {
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 10000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1.2s ease-out;
  display: flex;
  align-items: center;
  justify-content: center;
}
#blackout-overlay.show { opacity: 1; pointer-events: auto; }

.blackout-emoji {
  font-size: clamp(6rem, 25vw, 12rem);  /* â† TamaÃ±os mÃ¡s conservadores */
  opacity: 0;
  transform: scale(0.5);
  transition: opacity 1s ease-out 0.5s, transform 1s ease-out 0.5s;
  white-space: nowrap;
  letter-spacing: 0;
  max-width: 90vw;      /* â† Ancho mÃ¡ximo del 90% del viewport */
  text-align: center;   /* â† Centrar si hay mÃºltiples emojis */
}
#blackout-overlay.show .blackout-emoji {
  opacity: 1;
  transform: scale(1);
}

/* Explosion flash effect */
#flash-overlay {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center, #fff 0%, #ff6600 30%, #ff0000 60%, transparent 100%);
  z-index: 9500;
  opacity: 0;
  pointer-events: none;
}

/* Screen shake animation */
@keyframes screenShake {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  10% { transform: translate(-10px, 5px) rotate(-2deg); }
  20% { transform: translate(10px, -5px) rotate(2deg); }
  30% { transform: translate(-8px, -8px) rotate(-1deg); }
  40% { transform: translate(8px, 8px) rotate(1deg); }
  50% { transform: translate(-6px, 3px) rotate(-1deg); }
  60% { transform: translate(6px, -3px) rotate(1deg); }
  70% { transform: translate(-4px, -4px) rotate(-0.5deg); }
  80% { transform: translate(4px, 4px) rotate(0.5deg); }
  90% { transform: translate(-2px, 2px) rotate(-0.2deg); }
}

body.exploding #stage {
  animation: screenShake 0.8s cubic-bezier(.36,.07,.19,.97) both;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CONFETTI
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#confetti-canvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 8999;
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STAGE (fixed viewport)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="stage">

  <!-- floating petals -->
  <div id="petals"></div>

  <!-- â”€â”€ LAYER A: PHOTO â”€â”€ -->
  <div class="layer" id="layer-photo">
    <div id="photo-bg">
    </div>
    <div id="photo-vignette"></div>

    <div class="photo-footer">
      <h1 class="photo-caption">Tu &amp; Yo â™¡</h1>
      <span class="photo-tagline">eres la mejor novia del mundo</span>
      <div class="scroll-hint">
        <span class="scroll-label">scroll para una pregunta importante</span>
        <div class="chevs">
          <div class="chev"></div>
          <div class="chev"></div>
          <div class="chev"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ LAYER B: ENVELOPE â”€â”€ -->
  <div class="layer" id="layer-envelope">
    <div id="env-scene">

      <div class="envelope" id="envelope" onclick="openEnvelope()">
        <div class="env-body">
          <div class="env-back"></div>
          <div class="env-tri env-tri-l"></div>
          <div class="env-tri env-tri-r"></div>
          <div class="env-bottom"></div>
          <div class="env-flap"></div>

          <!-- Wax seal -->
          <div class="env-seal">
            <svg class="seal-svg" viewBox="0 0 100 92" xmlns="http://www.w3.org/2000/svg">
              <path d="M50 87C50 87 4 54 4 28C4 13 16 3 29 3C37 3 45 8 50 16C55 8 63 3 71 3C84 3 96 13 96 28C96 54 50 87 50 87Z" fill="#e8446a"/>
              <path d="M50 87C50 87 4 54 4 28C4 13 16 3 29 3C37 3 45 8 50 16C55 8 63 3 71 3C84 3 96 13 96 28C96 54 50 87 50 87Z" fill="none" stroke="rgba(255,200,215,.5)" stroke-width="2"/>
            </svg>
          </div>

          <!-- Card overlays ON the envelope -->
          <div class="env-card" id="card">
            <span class="card-icon">ğŸ’Œ</span>
            <h2>Quieres ser mi<br>Valentine?</h2>
            <p>Por muchos San Valentines juntos<br>"Te quiero mucho â™¡</p>
            <div class="choices">
              <button class="btn btn-yes"  onclick="celebrate(event)">Si! ğŸ’•</button>
              <button class="btn btn-yes2" onclick="explodeAndBlackout(event)">No ğŸ’€</button>
            </div>
          </div>
        </div>
      </div>

      <span id="env-tap">obvio no se me olvido preguntarte</span>
    </div>
  </div>

</div><!-- /stage -->

<!-- Love overlay -->
<div id="love-overlay">
  <div class="love-box">
    <span class="love-heart-big">ğŸ’–</span>
    <h1>Te Amo!</h1>
    <p class="love-sub">Feliz DÃ­a de San ValentÃ­n, mi amor â™¡</p>
    <div class="love-row">ğŸ’• ğŸ’ ğŸ’— ğŸ’“ ğŸ’</div>
  </div>
</div>

<!-- Blackout overlay -->
<div id="blackout-overlay">
  <div class="blackout-emoji">ğŸ˜¢ğŸ”«</div>
</div>

<!-- Flash overlay -->
<div id="flash-overlay"></div>

<canvas id="confetti-canvas"></canvas>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PETALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const petalWrap = document.getElementById('petals');
const PCOLS = ['rgba(247,184,200,.7)','rgba(253,215,224,.6)','rgba(232,68,106,.38)','rgba(240,155,180,.5)'];
for (let i = 0; i < 24; i++) {
  const p  = document.createElement('div');
  p.className = 'petal';
  const s  = 7 + Math.random() * 12;
  p.style.cssText = `left:${Math.random()*100}%;width:${s}px;height:${s}px;background:${PCOLS[i%4]};animation-duration:${6+Math.random()*9}s;animation-delay:${Math.random()*9}s;`;
  petalWrap.appendChild(p);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLL / SWIPE â†’ CROSSFADE
   
   No actual scrolling happens. We intercept
   wheel + touch events and accumulate a
   "progress" value (0 = photo, 1 = envelope).
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const layerPhoto    = document.getElementById('layer-photo');
const layerEnvelope = document.getElementById('layer-envelope');
const envScene      = document.getElementById('env-scene');

let progress = 0;          // 0 â†’ 1
let target   = 0;
let rafPending = false;
let touchStartY = 0;

const SENSITIVITY_WHEEL  = 0.0018;  // tuned for smooth feel
const SENSITIVITY_TOUCH  = 0.004;

function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }

function applyProgress() {
  progress = clamp(progress, 0, 1);

  // Photo fades out
  layerPhoto.style.opacity = 1 - progress;

  // Envelope: fade in + scale up from 0.1 â†’ 1
  layerEnvelope.style.opacity = progress;
  const sc = 0.1 + progress * 0.9;
  envScene.style.transform = `scale(${sc})`;

  // Enable pointer events only when mostly visible
  if (progress > 0.85) {
    layerEnvelope.classList.add('active');
  } else {
    layerEnvelope.classList.remove('active');
  }
}

function scheduleDraw() {
  if (rafPending) return;
  rafPending = true;
  requestAnimationFrame(() => {
    rafPending = false;
    // Lerp toward target for smoothness
    progress += (target - progress) * 0.12;
    if (Math.abs(target - progress) < 0.001) progress = target;
    applyProgress();
  });
}

// â”€â”€ Wheel (desktop / trackpad) â”€â”€
window.addEventListener('wheel', e => {
  e.preventDefault();
  target = clamp(target + e.deltaY * SENSITIVITY_WHEEL, 0, 1);
  scheduleDraw();
}, { passive: false });

// â”€â”€ Touch (iPhone) â”€â”€
window.addEventListener('touchstart', e => {
  touchStartY = e.touches[0].clientY;
}, { passive: true });

window.addEventListener('touchmove', e => {
  e.preventDefault();
  const dy = touchStartY - e.touches[0].clientY;
  touchStartY = e.touches[0].clientY;
  target = clamp(target + dy * SENSITIVITY_TOUCH, 0, 1);
  scheduleDraw();
}, { passive: false });

// Initial state
applyProgress();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OPEN ENVELOPE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let opened = false;
function openEnvelope() {
  if (progress < 0.85 || opened) return;
  opened = true;
  document.getElementById('envelope').classList.add('open');
  document.getElementById('env-tap').style.opacity = '0';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const canvas = document.getElementById('confetti-canvas');
const ctx    = canvas.getContext('2d');
let pieces   = [], rafId;

function resizeCanvas() { canvas.width = innerWidth; canvas.height = innerHeight; }
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const COLS = ['#e8446a','#f7b8c8','#c9965a','#9b5de5','#f15bb5','#fbbf24','#34d399','#60a5fa','#ff6b9d','#fce8ef'];

function burst(n, explosionMode = false) {
  const colors = explosionMode ? ['#ff0000','#ff4500','#ff6347','#ffa500','#ffff00','#ff8c00','#ff1493','#ff69b4'] : COLS;
  const speedMultiplier = explosionMode ? 3.5 : 1;
  
  for (let i = 0; i < n; i++) {
    const a = Math.random() * Math.PI * 2;
    const v = (4 + Math.random() * 14) * speedMultiplier;
    pieces.push({
      x:  canvas.width  * .5,
      y:  canvas.height * .5,
      w:  (5 + Math.random() * 12) * (explosionMode ? 2 : 1),
      h:  (4 + Math.random() * 8) * (explosionMode ? 2 : 1),
      r:  Math.random() * Math.PI * 2,
      dr: (.03 + Math.random() * .15) * (Math.random()<.5?1:-1) * (explosionMode ? 3 : 1),
      vx: Math.cos(a)*v, 
      vy: Math.sin(a)*v - (explosionMode ? 0 : 6),
      color: colors[Math.floor(Math.random()*colors.length)],
      alpha: 1,
      shape: explosionMode ? (Math.random()<.6?'rect':'circle') : (Math.random()<.28?'heart':Math.random()<.5?'circle':'rect')
    });
  }
}

function heart(x,y,s){
  ctx.beginPath();
  ctx.moveTo(x,y+s*.3);
  ctx.bezierCurveTo(x,y,x-s*.5,y,x-s*.5,y+s*.3);
  ctx.bezierCurveTo(x-s*.5,y+s*.65,x,y+s*.88,x,y+s*.88);
  ctx.bezierCurveTo(x,y+s*.88,x+s*.5,y+s*.65,x+s*.5,y+s*.3);
  ctx.bezierCurveTo(x+s*.5,y,x,y,x,y+s*.3);
  ctx.fill();
}

function tick(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  pieces = pieces.filter(p => p.alpha>.015);
  pieces.forEach(p => {
    p.x+=p.vx; p.y+=p.vy; p.vy+=.2; p.vx*=.993; p.r+=p.dr;
    if(p.y>canvas.height*.65) p.alpha-=.016;
    ctx.save();
    ctx.globalAlpha=p.alpha; ctx.fillStyle=p.color;
    ctx.translate(p.x,p.y); ctx.rotate(p.r);
    if(p.shape==='heart')       heart(-p.w/2,-p.h/2,p.w);
    else if(p.shape==='circle') { ctx.beginPath(); ctx.arc(0,0,p.w/2,0,Math.PI*2); ctx.fill(); }
    else                        ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
    ctx.restore();
  });
  if(pieces.length>0) rafId = requestAnimationFrame(tick);
  else ctx.clearRect(0,0,canvas.width,canvas.height);
}

function celebrate(e){
  e.stopPropagation();
  burst(200);
  setTimeout(()=>burst(160), 380);
  setTimeout(()=>burst(140), 850);
  setTimeout(()=>burst(100), 1500);
  cancelAnimationFrame(rafId);
  tick();
  setTimeout(()=>document.getElementById('love-overlay').classList.add('show'), 700);
}

function explodeAndBlackout(e) {
  e.stopPropagation();
  
  // Add screen shake
  document.body.classList.add('exploding');
  
  // Flash effect
  const flashOverlay = document.getElementById('flash-overlay');
  flashOverlay.style.transition = 'opacity 0.1s';
  flashOverlay.style.opacity = '1';
  
  setTimeout(() => {
    flashOverlay.style.transition = 'opacity 0.3s';
    flashOverlay.style.opacity = '0';
  }, 100);
  
  setTimeout(() => {
    flashOverlay.style.transition = 'opacity 0.08s';
    flashOverlay.style.opacity = '0.6';
  }, 350);
  
  setTimeout(() => {
    flashOverlay.style.transition = 'opacity 0.4s';
    flashOverlay.style.opacity = '0';
  }, 430);
  
  // Create MASSIVE explosion with multiple waves
  burst(500, true);  // Initial massive burst
  setTimeout(()=>burst(400, true), 100);
  setTimeout(()=>burst(350, true), 200);
  setTimeout(()=>burst(300, true), 350);
  setTimeout(()=>burst(250, true), 500);
  setTimeout(()=>burst(200, true), 650);
  setTimeout(()=>burst(150, true), 800);
  setTimeout(()=>burst(100, true), 950);
  
  cancelAnimationFrame(rafId);
  tick();
  
  // Fade to black after explosion
  setTimeout(() => {
    document.getElementById('blackout-overlay').classList.add('show');
  }, 1500);
  
  // Remove shake class
  setTimeout(() => {
    document.body.classList.remove('exploding');
  }, 800);
}
</script>
</body>
</html>